/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/thirdparty/URI','./Opa','./OpaPlugin','./PageObjectFactory','sap/ui/qunit/QUnitUtils','sap/ui/base/Object','sap/ui/Device','./matchers/Matcher','./matchers/AggregationFilled','./matchers/PropertyStrictEquals','./matchers/Properties','./matchers/Ancestor','./matchers/AggregationContainsPropertyEqual'],function($,U,O,a,P,b,c,D,M,A,d){var p=new a(),f=null,F=null,o=null,e=null,g=null,h=false,u=false;var j=c.extend("sap.ui.test.Opa5",jQuery.extend({},O.prototype,{constructor:function(){O.apply(this,arguments);}}));function s(S,T){g=$("#OpaFrame");var i=jQuery.sap.getModulePath("sap.ui.test.OpaFrame",".css");jQuery.sap.includeStyleSheet(i);if(!g.length){g=$('<iframe id="OpaFrame" class="opaFrame" src="'+S+'"></iframe>');$("body").append(g);}if(g[0].contentDocument&&g[0].contentDocument.readyState==="complete"){l();}else{g.on("load",l);}return this.waitFor({viewName:null,controlType:null,id:null,searchOpenDialogs:false,check:function(){if(!h){return;}return n();},timeout:T||80,errorMessage:"unable to load the iframe with the url: "+S});}j.iStartMyAppInAFrame=s;j.prototype.iStartMyAppInAFrame=s;function t(){return this.waitFor({success:function(){w();h=false;u=false;}});}j.iTeardownMyAppFrame=t;j.prototype.iTeardownMyAppFrame=t;j.prototype.waitFor=function(i){i=$.extend({},O.config,i);var x=i.check,C=null,y,z=i.success,B,R;i.check=function(){if(!this._modifyControlType(i)){return false;}C=j.getPlugin().getMatchingControls(i);if((i.viewName||i.searchOpenDialogs)&&!i.id&&!C||(C&&C.length===0)){jQuery.sap.log.debug("found no controls in view: "+i.viewName+" with controlType "+i.sOriginalControlType,"","Opa");return false;}if(typeof i.id==="string"&&!C){jQuery.sap.log.debug("found no control with the id "+i.id,"","Opa");return false;}if(i.id instanceof RegExp&&!C.length){jQuery.sap.log.debug("found no control with the id regex"+i.id);return false;}if($.isArray(i.id)&&(!C||C.length!==i.id.length)){if(C&&C.length){jQuery.sap.log.debug("found not all controls with the ids "+i.id+" onlyFound the controls: "+C.map(function(H){return H.sId;}));}else{jQuery.sap.log.debug("found no control with the id  "+i.id);}return false;}if(i.sOriginalControlType&&!C.length){jQuery.sap.log.debug("found no controls with the type  "+i.sOriginalControlType,"","Opa");return false;}y=this._checkMatchers(i.matchers);var E;if(y&&y.length){if(!$.isArray(C)){E=1;B=[C];}else{B=C;}var G=[];B.forEach(function(H){var I=this._doesValueMatch(y,H);if(I){if(I===true){G.push(H);}else{G.push(I);}}},this);if(!G.length){jQuery.sap.log.debug("all results were filtered out by the matchers - skipping the check");return false;}if(E===1){R=G[0];}else{R=G;}}else{R=C;}if(x){return this._executeCheck(x,R);}return true;};if(z){i.success=function(){z.call(this,R);};}return O.prototype.waitFor.call(this,i);};j.getPlugin=function(){return o||p;};j.getJQuery=function(){return F;};j.getWindow=function(){return f;};j.getUtils=function(){return e;};j.getHashChanger=function(){if(!f){return null;}f.jQuery.sap.require("sap.ui.core.routing.HashChanger");return f.sap.ui.core.routing.HashChanger.getInstance();};j.extendConfig=O.extendConfig;j.resetConfig=function(){O.resetConfig();O.extendConfig({viewNamespace:"",arrangements:new j(),actions:new j(),assertions:new j(),visible:true,_stackDropCount:1});};j.emptyQueue=O.emptyQueue;j.getContext=O.getContext;j.matchers={};j.matchers.Matcher=M;j.matchers.AggregationFilled=A;j.matchers.PropertyStrictEquals=d;j.createPageObjects=function(i){return P.create(i,j);};j.prototype._doesValueMatch=function(x,V){var y=V;var I=true;jQuery.each(x,function(i,z){var B=z.isMatching(V);if(B){if(B!==true){V=B;}}else{I=false;return false;}});if(I){return(y===V)?true:V;}else{return false;}};j.prototype._checkMatchers=function(i){var x=[];if($.isArray(i)){x=i;}else if(i){x=[i];}x=x.map(function(y){if(y instanceof j.matchers.Matcher){return y;}else if(typeof y=="function"){return{isMatching:y};}jQuery.sap.log.error("Matchers where defined, but they where neither an array nor a single matcher: "+i);return undefined;}).filter(function(y){return!!y;});return x;};j.prototype._modifyControlType=function(i){var C=i.controlType;if(typeof C!=="string"){return true;}i.sOriginalControlType=C;var W=f||window;var x=W.jQuery.sap.getObject(C);if(!x){jQuery.sap.log.debug("The control type "+C+" is undefined. Skipped check and will wait until it is required",this);return false;}if(x._sapUiLazyLoader){jQuery.sap.log.debug("The control type "+C+" is currently a lazy stub. Skipped check and will wait until it is invoked",this);return false;}i.controlType=x;return true;};j.prototype._executeCheck=function(C,i){jQuery.sap.log.debug("Opa is executing the check: "+C);var R=C.call(this,i);jQuery.sap.log.debug("Opa check was "+R);return R;};j.resetConfig();function k(){F=f.jQuery;r("sap.ui.test");F.sap.require("sap.ui.test.OpaPlugin");o=new f.sap.ui.test.OpaPlugin();r("sap.ui.qunit.QUnitUtils");f.jQuery.sap.require("sap.ui.qunit.QUnitUtils");e=f.sap.ui.qunit.QUnitUtils;}function r(i){var x=jQuery.sap.getModulePath(i);var y=new U(x).absoluteTo(document.baseURI).search("").toString();F.sap.registerModulePath(i,y);}function l(){f=g[0].contentWindow;m();h=true;n();}function m(){if(D.browser.internet_explorer&&D.browser.version===9){return;}var i=f.onerror;f.onerror=function(E,x,L){if(i){i.apply(this,arguments);}throw"OpaFrame error message: "+E+" url: "+x+" line: "+L;};}function n(){if(u){return true;}if(f&&f.sap&&f.sap.ui&&f.sap.ui.getCore){u=true;q();}return false;}function q(){k();v();}function v(){f.jQuery.sap.require("sap.ui.thirdparty.hasher");f.jQuery.sap.require("sap.ui.core.routing.History");f.jQuery.sap.require("sap.ui.core.routing.HashChanger");var H=new f.sap.ui.core.routing.HashChanger(),i=new f.sap.ui.core.routing.History(H),x=f.hasher,y=x.setHash,z=x.getHash,C,B=f.history.go;x.replaceHash=function(I){var J=this.getHash();C=I;H.fireEvent("hashReplaced",{sHash:I});this.changed.dispatch(I,J);};x.setHash=function(I){var R=z.call(this);C=I;H.fireEvent("hashSet",{sHash:I});y.apply(this,arguments);if(R===this.getHash()){this.changed.dispatch(R,i.aHistory[i.iHistoryPosition]);}};x.getHash=function(){if(C===undefined){return z.apply(this,arguments);}return C;};H.init();function E(){var N=i.aHistory[i.iHistoryPosition],I=i.getPreviousHash();C=I;x.changed.dispatch(I,N);}function G(){var N=i.aHistory[i.iHistoryPosition+1],I=i.aHistory[i.iHistoryPosition];if(N===undefined){jQuery.sap.log.error("Could not navigate forwards, there is no history entry in the forwards direction",this);return;}C=N;x.changed.dispatch(N,I);}f.history.back=E;f.history.forward=G;f.history.go=function(S){if(S===-1){E();return;}else if(S===1){G();return;}jQuery.sap.log.error("Using history.go with a number greater than 1 is not supported by OPA5",this);return B.apply(f.history,arguments);};}function w(){g.remove();f=null;F=null;o=null;e=null;}$(function(){g=$("#OpaFrame");g.on("load",l);$("body").height("100%");$("html").height("100%");});return j;});
